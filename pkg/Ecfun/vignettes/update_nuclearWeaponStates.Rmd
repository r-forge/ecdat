---
title: "Update nuclearWeaponStates dataset"
author: "Spencer Graves"
date: "4/25/2019"
output: html_document
vignette: >
  %\VignetteIndexEntry{Update nuclearWeaponStates dataset}
  %\VignetteKeyword{nuclear-weapon states}
  %\VignetteEngine{knitr::rmarkdown}
  %\SweaveUTF8
  \usepackage[utf8](inputenc)

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Write existing 

This document describes how to add new information to the nuclearWeaponStates dataset in the Ecdat package.  

The first step is to update the companion "nuclearWeaponStates.Rd" file.  

Then you want to export the nuclearWeaponStates dataset as a csv file:

```{r export}
library(Ecdat)
availInPkg <- objects(2, pattern='nuclearWeaponStates')
if('nuclearWeaponStates' %in% availInPkg){
  data(nuclearWeaponStates)
  write.csv(nuclearWeaponStates, 
            'nuclearWeaponStates.csv')
}
getwd()
```

## Edit and read 

Next edit the csv file just created to match your revised  "nuclearWeaponStates.Rd".

After that's done, put it in the current working directory and read it:

```{r readCSV}
library(Ecfun)
nWS <- read.csv(
  'nuclearWeaponStates.csv', 
  stringsAsFactors = FALSE)
nuclearWeaponStates <-
  asNumericDF(nWS, 
          ignore=1:2, Dates=3) 
```

## Check 

There are two checks we can perform:  

# Does yearsSincePreviousTest = diff(firstTest)?

```{r chk1}
dDays <- diff(
  nuclearWeaponStates[,
                    'firstTest'])
dYrs <- (dDays / 365.25)
edYrs <- (nuclearWeaponStates[-1,
      'yearsSinceLastFirstTest'] 
    - dYrs)
cbind(dDays, dYrs, edYrs)

oopsDifYrs <- which(abs(
  nuclearWeaponStates[-1,
    'yearsSinceLastFirstTest'] - 
        dYrs)>.005)
if(length(oopsDifYrs)>1){
  cat('difftime compute errors. ', 
      ' bad rows = ')
  print(oopsDifYrs)
  oopsi <- unique(c(oopsDifYrs, 
            oopsDifYrs+1))
  cbind(oopsi, nuclearWeaponStates[oopsi, 
      1:3])
}
```

# number of nuclearWeapons

```{r nukes}
nukes <- rowSums(nuclearWeaponStates[, 
  c('nYieldNA', 'nLowYield', 'nMidYield',
    'nHighYield')])
dnuk <- (nuclearWeaponStates[,
    'nuclearWeapons'] - nukes)
if(length(oopsNuk <- which(dnuk != 0))>0){
  cat('count errors.  bad rows =')
  print(oopsNuk)
  cbind(oopsi, nuclearWeaponStates[, -(2:3)])
}
```

# plot 

```{r plot}
data(nuclearWeaponStates)
plot(yearsSinceLastFirstTest~firstTest, nuclearWeaponStates, 
      type='h', xlab='', ylab='')
with(nuclearWeaponStates, 
  text(firstTest, yearsSinceLastFirstTest, ctry))
```  
  
# save 

```{r save}
save(nuclearWeaponStates, 
     file='nuclearWeaponStates.rda')
```

Then copy the *.rda file from the current working directory to "ecdat\data", and run "R CMD checka" as usual.  
